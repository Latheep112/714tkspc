{% extends "base.html" %}
{% block page_title %}<h2 class="mb-0">Teachers</h2>{% endblock %}
{% block breadcrumbs %}
  <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
  <li class="breadcrumb-item active" aria-current="page">Teachers</li>
{% endblock %}
{% block content %}
    <div class="row mb-3">
        <div class="col-md-8">
            <form method="get" action="{{ url_for('teachers') }}" class="form-inline">
                <input type="text" class="form-control mr-2 js-table-filter" data-target="#teachersTable" name="q" placeholder="Search name/email/phone" value="{{ q }}">
                <button type="submit" class="btn btn-outline-secondary btn-icon"><i class="fas fa-search"></i> Search</button>
            </form>
        </div>
        <div class="col-md-4">
            <a href="{{ url_for('add_teacher') }}" class="btn btn-primary float-right btn-icon"><i class="fas fa-user-plus"></i> Add Teacher</a>
        </div>
    </div>
    <div class="table-responsive skeleton-onload">
    <table id="teachersTable" class="table table-striped table-hover js-table table-sticky-header">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Department</th>
                <th>Designation</th>
                <th>Qualification</th>
                <th>Expertise</th>
                <th>Experience</th>
                <th>Office Hours</th>
                <th class="col-employment">Employment Status</th>
                <th class="col-max-hours">Max Weekly Hours</th>
                <th style="min-width: 320px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if teachers %}
            {% for teacher in teachers %}
                <tr>
                    <td>
                        {% set avatar = photos.get(teacher.email) %}
                        {% if avatar %}
                        <img src="{{ avatar }}" alt="{{ teacher.name }} avatar" class="rounded-circle me-2" style="width:28px;height:28px;object-fit:cover;">
                        {% else %}
                        <span class="badge bg-secondary me-2" style="width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;">{{ (teacher.name[:1] if teacher.name else '?') }}</span>
                        {% endif %}
                        {{ teacher.name }}
                    </td>
                    <td>{{ teacher.email }}</td>
                    <td>{{ teacher.phone }}</td>
                    <td>{{ teacher.department or '-' }}</td>
                    <td>{{ teacher.designation or '-' }}</td>
                    <td>{{ teacher.qualification or '-' }}</td>
                    <td>{{ teacher.subject_expertise or '-' }}</td>
                    <td>{{ teacher.experience_years or '0' }} yrs</td>
                    <td>{{ teacher.office_hours or '-' }}</td>
                    <td class="col-employment">{{ teacher.employment_status or '-' }}</td>
                    <td class="col-max-hours">{{ teacher.max_weekly_hours or '-' }}</td>
                    <td class="text-nowrap">
                        <a href="{{ url_for('edit_teacher', teacher_id=teacher.id) }}" class="btn btn-secondary btn-sm btn-icon"><i class="fas fa-edit"></i> Edit</a>
                        <a href="{{ url_for('teacher_leave', teacher_id=teacher.id) }}" class="btn btn-outline-info btn-sm btn-icon"><i class="far fa-calendar-minus"></i> Leave</a>
                        <a href="{{ url_for('teacher_performance', teacher_id=teacher.id) }}" class="btn btn-outline-success btn-sm btn-icon"><i class="fas fa-chart-line"></i> Performance</a>
                        <form action="{{ url_for('delete_teacher', teacher_id=teacher.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm btn-icon" onclick="return confirm('Are you sure you want to delete this teacher?');"><i class="fas fa-trash-alt"></i> Delete</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="12" class="text-center text-muted">No teachers found. <a href="{{ url_for('add_teacher') }}">Add a teacher</a>.</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
    </div>
    {% if pagination %}
    <nav>
        <ul class="pagination">
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('teachers', page=pagination.prev_num, q=q) }}">Previous</a>
            </li>
            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('teachers', page=pagination.next_num, q=q) }}">Next</a>
            </li>
        </ul>
    </nav>
    {% endif %}
{% endblock %}
