{% extends "base.html" %}
{% block page_title %}<h2 class="mb-0">Courses</h2>{% endblock %}
{% block breadcrumbs %}
  <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
  <li class="breadcrumb-item active" aria-current="page">Courses</li>
{% endblock %}
{% block content %}
    <div class="row mb-3">
        <div class="col-md-8">
            <form method="get" action="{{ url_for('courses') }}" class="form-inline">
                <input type="text" class="form-control mr-2 js-table-filter" data-target="#coursesTable" name="q" placeholder="Search name/code/faculty" value="{{ q }}">
                <button type="submit" class="btn btn-outline-secondary btn-icon"><i class="fas fa-search"></i> Search</button>
            </form>
        </div>
        <div class="col-md-4">
            {% if session.get('role') != 'parent' %}
            <a href="{{ url_for('add_course') }}" class="btn btn-primary float-right btn-icon"><i class="fas fa-plus"></i> Add Course</a>
            {% endif %}
        </div>
    </div>
    <div class="table-responsive skeleton-onload">
    <table id="coursesTable" class="table table-striped table-hover js-table table-sticky-header courses-table">
        <thead>
            <tr>
                <th class="col-name">Name</th>
                <th class="col-code">Code</th>
                <th class="col-dept">Dept/Sem</th>
                <th class="col-type">Type</th>
                <th class="col-year">Year</th>
                <th class="col-level">Level</th>
                <th class="col-credits">Credits</th>
                <th class="col-teacher">Faculty</th>
                <th class="col-room">Room</th>
                <th class="col-capacity">Capacity</th>
                <th class="col-remaining">Rem</th>
                <th style="min-width: 400px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if courses %}
            {% for course in courses %}
                <tr>
                    <td class="col-name">{{ course.name }}</td>
                    <td class="col-code">{{ course.code }}</td>
                    <td class="col-dept">{{ course.department or '-' }} / {{ course.semester or '-' }}</td>
                    <td class="col-type">{{ course.course_type or '-' }}</td>
                    <td class="col-year">{{ course.academic_year or '-' }}</td>
                    <td class="col-level">{{ course.level or '-' }}</td>
                    <td class="col-credits">{{ course.credits }}</td>
                    <td class="col-teacher">{{ course.teacher.name }}</td>
                    <td class="col-room">{{ course.room or '-' }}</td>
                    <td class="col-capacity">{{ course.capacity or '-' }}</td>
                    <td class="col-remaining">
                        {% if course.capacity is not none %}
                            {% set remaining = course.capacity - (course.students|length) %}
                            {% if remaining < 0 %}{% set remaining = 0 %}{% endif %}
                            <span class="badge bg-{{ 'danger' if remaining == 0 else ('warning' if remaining < 5 else 'success') }}">{{ remaining }}</span>
                        {% else %}
                            &infin;
                        {% endif %}
                    </td>
                    <td class="text-nowrap">
                        <a href="{{ url_for('course_details', course_id=course.id) }}" class="btn btn-secondary btn-sm btn-icon"><i class="far fa-eye"></i> View</a>
                        {% if session.get('role') != 'parent' %}
                        <a href="{{ url_for('course_plan', course_id=course.id) }}" class="btn btn-primary btn-sm btn-icon"><i class="far fa-calendar"></i> Plan</a>
                        <a href="{{ url_for('enroll_student', course_id=course.id) }}" class="btn btn-info btn-sm btn-icon"><i class="fas fa-user-plus"></i> Enroll</a>
                        <a href="{{ url_for('edit_course', course_id=course.id) }}" class="btn btn-warning btn-sm btn-icon"><i class="fas fa-edit"></i> Edit</a>
                        <form action="{{ url_for('delete_course', course_id=course.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm btn-icon" onclick="return confirm('Are you sure you want to delete this course?');"><i class="fas fa-trash-alt"></i> Delete</button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="11" class="text-center text-muted">
                    No courses found.
                    {% if session.get('role') != 'parent' %}
                    <a href="{{ url_for('add_course') }}">Add a course</a>.
                    {% endif %}
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
    </div>
    {% if pagination %}
    <nav>
        <ul class="pagination">
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('courses', page=pagination.prev_num, q=q) }}">Previous</a>
            </li>
            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('courses', page=pagination.next_num, q=q) }}">Next</a>
            </li>
        </ul>
    </nav>
    {% endif %}
{% endblock %}
